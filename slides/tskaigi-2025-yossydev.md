---
title: "Rustè£½JavaScript Engineã®TypeScriptã‚µãƒãƒ¼ãƒˆ"
description: "è¿‘å¹´ã€TypeScriptã¯åºƒãæ™®åŠã—ã€ä¸»è¦ãªJavaScriptãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚‚å¯¾å¿œã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚ã—ã‹ã—ã€ã“ã‚Œã‚‰ã¯ã‚ãã¾ã§ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å´ã§ã®ã‚µãƒãƒ¼ãƒˆã§ã‚ã‚Šã€ã‚¨ãƒ³ã‚¸ãƒ³è‡ªä½“ãŒTypeScriptã‚’ç›´æ¥å®Ÿè¡Œã™ã‚‹ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æœ¬LTã§ã¯ã€Rustè£½JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ Nova ã«ãŠã‘ã‚‹TypeScriptå®Ÿè¡Œã®å–ã‚Šçµ„ã¿ã‚’ç´¹ä»‹ã—ã€ã‚¨ãƒ³ã‚¸ãƒ³ãƒ¬ãƒ™ãƒ«ã§ã®TypeScriptã‚µãƒãƒ¼ãƒˆã®å¯èƒ½æ€§ã«ã¤ã„ã¦è€ƒå¯Ÿã—ã¾ã™ã€‚"
marp: true
theme: default
paginate: true
---

# Rustè£½JavaScript Engineã®TypeScriptã‚µãƒãƒ¼ãƒˆ

2025/05/23 [tskaigi 2025](https://2025.tskaigi.org/talks/yossydev)

<!--
ã‚¹ãƒ©ã‚¤ãƒ‰
-->

---

## Rustè£½JavaScript Engine is Nova

- [Why build a JavaScript engine?](https://trynova.dev/blog/why-build-a-js-engine)
- [What is the Nova JavaScript engine?](https://trynova.dev/blog/what-is-the-nova-javascript-engine)
- Rustè¨€èªã§æ›¸ã‹ã‚ŒãŸJavaScriptã‚¨ãƒ³ã‚¸ãƒ³
  - ä»–ã®JavaScriptã‚¨ãƒ³ã‚¸ãƒ³: v8,JavaScriptCore,SpiderMonkey,LibJS,Boaãªã©
- test262ã®é€šéç‡ã¯ç´„66%
    1. å¤§ä½“å‹•ã: Array,Map,TypedArray,Proxy, etcâ€¦
    2. æœªå®Ÿè£…: Module,RegExp,Atomic, etcâ€¦

<!--
- ã‚¿ã‚¤ãƒˆãƒ«ã«ã‚ã‚‹Rustè£½JavaScriptã¨ã¯Novaã®ã“ã¨ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚
- NovaãŒä½•ã‹ã¨ã‹ã€ãªã‚“ã§ä½œã£ã¦ã„ã‚‹ã‹ã€‚ã¿ãŸã„ãªè©±ã¯ã€ä»Šæ—¥ã¯ã—ã¾ã›ã‚“ã€‚
- ãªã®ã§ã‚ˆã‹ã£ãŸã‚‰è²¼ã£ã¦ã‚ã‚‹ãƒªãƒ³ã‚¯ã€Why build a JavaScript engine/What is the Nova JavaScript engineã‚’è¦‹ã¦ãã ã•ã„ã€‚
- ã•ã‚‰ã«æ™‚é–“ãŒãªã„ã®ã§ã€çµæ§‹è‰²ã€…ãªèª¬æ˜ã‚’çœã„ã¦ã„ã¾ã™ã€‚å¾Œã§èª¿ã¹ã‚‹ã‹èãã‹ã—ã¦ãã ã•ã„ã€‚
- ç°¡å˜ã«åƒ•ã®å£ã‹ã‚‰èª¬æ˜ã‚’ã—ã¦ãŠãã¨ã€Novaã¨ã¯ã€Rustè¨€èªã§æ›¸ã‹ã‚ŒãŸJavaScriptã®ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚
- JavaScriptã®ã‚¨ãƒ³ã‚¸ãƒ³ã¯æœ‰åã©ã“ã‚ã§ã„ã†ã¨ã€v8,JavaScriptCore,SpiderMonkey,LibJS,Boaãªã©ãŒã‚ã‚Šã¾ã™ã€‚
- ã“ã®Novaã¯ã€ecma262ã«å¯¾ã—ã¦ã®ãƒ†ã‚¹ãƒˆã§ã‚ã‚‹test262ã¯ã€ä»Šç´„66%ã»ã©é€šã£ã¦ã„ã¾ã™ã€‚
- ä»Šã¯ã€Array,Map,TypedArray,Proxyãªã©ã¯å¤§ä½“å‹•ãã¾ã™ãŒã€Module,RegExp,Atomicãªã©ã¯ã¾ã å‹•ã‹ãªã„ã§ã™
-->

---

## JavaScript Engineã§TypeScriptã‚’å®Ÿè¡Œã™ã‚‹ï¼ˆğŸ¤”ï¼‰

<!--
- ã•ã¦ã€ã“ã“ã‹ã‚‰æœ¬é¡Œã®JavaScript Engineã§TypeScriptã‚’å®Ÿè¡Œã™ã‚‹è©±ã‚’ã—ã¾ã™ã€‚
-->

---

## JavaScript Engineã§TypeScriptã‚’å®Ÿè¡Œã™ã‚‹ï¼ˆğŸ¤”ï¼‰
Q. ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ã‹ã—ã¦ãã ã•ã„ã€‚
```ts
const str: string = "TSKaigi 2025!!"
```

<!--
- çªç„¶ã§ã™ãŒã€ã“ã¡ã‚‰ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ã‹ã—ã¦ã¿ã¦æ¬²ã—ã„ã§ã™ã€‚
-->

---

## JavaScript Engineã§TypeScriptã‚’å®Ÿè¡Œã™ã‚‹ï¼ˆğŸ¤”ï¼‰
Q. ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```ts
const str: string = "TSKaigi 2025!!"
```

A. å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯JavaScriptã®æ§‹æ–‡ã§ã¯ãªã„ã®ã§æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã¨ãªã‚‹ã€‚
ï¼ˆ`Uncaught SyntaxError: Missing initializer in const declaration`ï¼‰

<!--
- ã“ã¡ã‚‰ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚
- ãªãœãªã‚‰ã€å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯JavaScriptã®æ§‹æ–‡ã§ã¯ãªã„ãŸã‚ã§ã™ã€‚
- ä¸€å¿œè£œè¶³ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã—ã¦ã‚‚ã‚‰ã£ãŸã®ã¯ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèªã—ã¦ã‚‚ã‚‰ã†ãŸã‚ã§ã™ã€‚ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ‰‹å…ƒã§ç”¨æ„ã—ã¦ã‚‚ã‚‰ã†ã¨ã‹å¤§å¤‰ã ã¨æ€ã†ã®ã§ã€‚
-->

---

## Novaã§ã¯
Novaã§ã¯ã€Rustã®featureãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§TypeScriptã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹

```ts
const str: string = "TSKaigi 2025!!"

$ cargo run --features typescript eval index.ts
$ andromeda run index.ts
```

<!--
- ã•ã¦ã€ã“ã“ã‹ã‚‰Novaã®è©±ã§ã™ã€‚Novaã§ã¯ã€Rustã®featureãƒ•ãƒ©ã‚°ã‚’ä»•æ§˜ã™ã‚‹ã“ã¨ã§ã€TypeScriptã‚’å®Ÿè¡Œã§ãã‚‹æ§˜ã«ãªã£ã¦ã„ã¾ã™ã€‚
- ãªã®ã§ã€å…ˆã»ã©ã®ã‚³ãƒ¼ãƒ‰ã‚‚å‹•ãã¾ã™ã€‚
- æ‰‹å…ƒã§Novaã‚’cloneã—ã¦ã‚‚ã‚‰ã£ã¦ã€å®Ÿè¡Œã™ã‚‹ã‹ã€ã‚‚ã—ãã¯andromedaã£ã¦ã„ã†ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚‚ã‚ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’ä½¿ã£ã¦ã‚‚ã‚‰ã£ã¦å‹•ã‹ã—ã¦ã¿ã¦ã‚‚ã‚‰ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚
-->

---

## å®Ÿè£…ã‚³ãƒ¼ãƒ‰

```rs
let mut source_type = if strict_mode {
    SourceType::default().with_module(true)
} else {
    SourceType::default().with_script(true)
};
if cfg!(feature = "typescript") {
    source_type = source_type.with_typescript(true);
}
```

ã‚‚ã—ã‹ã—ãŸã‚‰jsxã‚‚å‹•ãã‹ã‚‚...ï¼Ÿï¼ŸğŸ‘€

```ts
if cfg!(feature = "jsx") {
    source_type = source_type.with_jsx(true);
}
```

<!--
- å…·ä½“çš„ãªå®Ÿè£…ã‚³ãƒ¼ãƒ‰ã‚’å°‘ã—ã¿ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
- æœ€åˆã®with_moduleã¨ã‹with_scirptã¨ã‹ã¯ç„¡è¦–ã—ã¦ã‚‚ã‚‰ã£ã¦ã€æ¬¡ã®ã¨ã“ã‚ã§ã™ã­ã€‚
- feature = typescriptã¨å›²ã¾ã‚ŒãŸä¸­ã«ã€with_typescript: trueã¨æ›¸ã„ã¦ã„ã¾ã™ã€‚
- å®Ÿã¯å…ˆã»ã©ã®å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã ã‘ãªã‚‰ã€ã“ã‚Œã ã‘ã§å‹•ä½œã—ã¾ã™ã€‚ç†ç”±ã¯å¾Œã§è©±ã—ã¾ã™ã€‚
- ã‚ã¨ã€ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã§ã¦ã„ã¦æ°—ã¥ã„ãŸã‚“ã§ã™ãŒã€with_jsxã¨ã„ã†ã®ã‚‚ã‚ã‚‹ã¿ãŸã„ã§ã™ã€‚
- ã“ã‚Œã‚’ä½¿ãˆã°ã€è‰²ã€…ã‚„ã‚‹ã“ã¨ã¯ã‚ã‚Šãã†ã ã—ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€jsxã‚‚engineã§å‡¦ç†ã§ãã‚‹æ§˜ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã­ã€‚
- engineã®jsxå®Ÿè¡Œã¯åƒ•ã¯å¿…è¦ã ã¨ã¯æ€ã‚ãªã„ã§ã™ãŒã€å¯èƒ½æ€§ãŒã‚ã‚‹ã“ã¨ã¯ã„ã„ã“ã¨ã§ã™ã€‚
-->

---

## ã©ã®ã‚ˆã†ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ

- Parserã«oxcã‚’ä½¿ç”¨
  ```rs
  // nova_vm/src/ecmascript/scripts_and_modules/source_code.rs#L95
  let parser = Parser::new(..., source_text, source_type);
  ```
- Parseå¾Œã«ã€JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ãªã‚‰å½“ç„¶ã€bytecodeã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å‡¦ç†ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹
- TypeScriptç‹¬è‡ªã®æ§‹æ–‡ã§ã‚ã‚‹enumã‚„namespaceã‚‚åŒæ§˜ã«JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ãŒæ‰±ã†ãªã‚‰bytecodeã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹
- enumã®bytecodeã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã¯å®Ÿè£…é€”ä¸­ï¼ˆ [#598](https://github.com/trynova/nova/pull/598) ï¼‰

<!--
- æ¬¡ã«ã€ã©ã®ã‚ˆã†ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ã‹ã§ã™ã€‚
- ã¾ãšã€Parserã«ã¯oxcã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
- å…ˆã»ã©ã®with_typescriptã‚„with_jsxã‚‚ã€oxcã®apiã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹ã®ã§ä½¿ãˆã¦ã„ã‚‹ã¨ã„ã†æ„Ÿã˜ã§ã™ã€‚
- Parser:newã£ã¦ã¨ã“ã‚ã§ã€source_typeã‚’æ¸¡ã—ã¦ã„ã‚‹ã‹ã¨æ€ã„ã¾ã™ãŒã€ã“ã“ã®with_typescriptã¿ãŸã„ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå…¥ã£ã¦ãã¾ã™ã€‚
- source_textã¯source_textã§ã™ã€‚
- ãã—ã¦ã“ã®parseå¾Œã«ã€JavaScriptã‚¨ãƒ³ã‚¸ãƒ³ãªã‚‰å½“ç„¶ã€bytecodeã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹å‡¦ç†ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- ã“ã“ã§ãƒã‚¤ãƒ³ãƒˆãªã®ã¯ã€TypeScriptç‹¬è‡ªã®æ§‹æ–‡ã§ã‚ã‚‹enumã‚„namespaceã‚‚åŒæ§˜ã«ã€JavaScript EngineãŒæ‰±ã†ãªã‚‰bytecodeã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- enumã¯ã‚„ã£ã¦ã¿ã¦ã¨è¨€ã‚ã‚ŒãŸã®ã§ã€å‹•ã‹ã™ã ã‘ãªã‚‰ã€å¾Œå°‘ã—ã§ã§ãã‚‹ã‹ãªã¨æ€ã„ã¾ã™ã€é€”ä¸­ã¾ã§æ›¸ãã¾ã—ãŸã€‚
-->

---

## æ­£å¼ã«ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã®ï¼Ÿ

- ã‚ã‹ã‚‰ãªã„ğŸ¤·â€â™‚ï¸
- TypeScriptã®ã‚µãƒãƒ¼ãƒˆã‚’ãƒ¡ã‚¤ãƒ³ã«è€ƒãˆã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€æœ¬æ ¼çš„ã«ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‹ã¯ã‚ã‹ã‚‰ãªã„
  - ã¾ãštest262ã‚’é€šã™ã“ã¨ãŒå„ªå…ˆã€‚
- ç¾çŠ¶ã®TypeScriptã‚µãƒãƒ¼ãƒˆã‚‚èã„ãŸã‚‰ã€ã€Œã‚„ã£ã¦ã¿ãŸã‚‰å‹•ã„ãŸï¼ã€ã¿ãŸã„ãªæ„Ÿã˜ã ã£ãŸã€‚
- ãªã®ã§èª°ã‹æ‰‹ãŒç©ºã„ãŸäººãŒé€²ã‚ã¦ã„ãã¿ãŸã„ãªæ„Ÿã˜ã«ã¯ãªã‚‹ã¨æ€ã†ã€‚

<!--
- ã§ã¯NovaãŒæ­£å¼ã«TypeScriptã‚µãƒãƒ¼ãƒˆã‚’ã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚
- ã¾ãæœ¬å½“ã«ã“ã‚Œã¯ã‚ã‹ã‚‰ãªã„ã§ã™ã€‚
- å°‘ãªãã¨ã‚‚ä»Šç¾åœ¨ã®ãƒ¡ã‚¤ãƒ³ã§ã‚„ã‚ŠãŸã„ã“ã¨ã§ã¯ãªã„ã€ã¯ãšã€‚
- ãã‚Œä»¥ä¸Šã«ç¾çŠ¶ã¯test262ã‚’é€šã—ã¦ã„ãã“ã¨ã®æ–¹ãŒå¤§äº‹ã€‚
- ç¾çŠ¶ã®TSã‚µãƒãƒ¼ãƒˆã‚‚ã€èã„ã¦ã¿ãŸã‚‰ã€Œã‚„ã£ã¦ã¿ãŸã‚‰å‹•ã„ãŸï¼ã€ã¿ãŸã„ãªæ„Ÿã˜ã ã£ãŸã€‚
- ãªã®ã§ã€èª°ã‹æ‰‹ãŒç©ºã„ãŸäººãŒé€²ã‚ã¦ã„ãã¿ãŸã„ãªæ„Ÿã˜ã«ã¯ãªã‚‹ã¨æ€ã†ã€‚ã‚„ã£ã¦ãã‚Œã¦ã‚‚ã„ã„ã€‚
-->

---

## å€‹äººçš„ãªæ„è¦‹

ç¾çŠ¶ã®é–‹ç™ºã«ãŠã„ã¦ã€TypeScriptã‚’ä½¿ã‚ãªã„ã“ã¨ã¯ã‚ã‚Šãˆãªããªã£ã¦ãã¦ã„ã‚‹ï¼ˆã¨ã„ã†ã‹ãªã£ã¦ã„ã‚‹ï¼‰ã€‚
ã§ã‚ã‚Œã°ã€JS EngineãŒTypeScriptã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚‚è‰¯ã„ã®ã‹ãªã¨æ€ã†ã€‚
ãã—ã¦ãã®çµæœã€ã‚ã‚ã‚ˆãã°å‹æƒ…å ±ã‚’ä½¿ã£ãŸæœ€é©åŒ–ã‚’å¯èƒ½ã«ã—ã€ã‚ˆã‚ŠJavaScriptãŒé«˜é€Ÿã§å‹•ãã“ã¨ã‚’æœŸå¾…ã—ãŸã„ã€‚

<!--
ã‚¹ãƒ©ã‚¤ãƒ‰
-->
